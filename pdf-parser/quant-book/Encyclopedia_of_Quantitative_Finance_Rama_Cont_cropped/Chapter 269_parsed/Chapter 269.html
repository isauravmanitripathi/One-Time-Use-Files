<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
 </head>
 <body>
  <h1>
   <b>
    Sensitivity Computations: Integration by Parts
   </b>
  </h1>
  <h2>
   Traditional Monte Carlo Sensitivity
   <b>
    Estimators and Their difficulties
   </b>
  </h2>
  <p block-type="Text">
   The calculation of price sensitivities is a central modeling and computational problem for derivative securities. The prices of derivative securities are observable in the market; however, price sensitivities, the important inputs in the hedging of derivative securities, are not. Models and computational tools are thus required to establish such information which the market does not provide directly.
  </p>
  <p block-type="Text">
   Mathematically, price sensitivities or greeks are partial derivatives of financial derivative prices with respect to some specific parameters of the underlying market variables. For instance, "delta" means the sensitivity to changes in the price of the underlying asset. More formally, suppose that the underlying model dynamic under the risk neutral probability is given by a stochastic differential equation (SDE) on
   <math display="inline">
    [0, T],
   </math>
  </p>
  <p block-type="Equation">
   <math display="block">
    dX_t = \mu(X_t) dt + \sigma(X_t) dW_t, X_0 = x \qquad (1)
   </math>
  </p>
  <p block-type="Text">
   where
   <math display="inline">
    W
   </math>
   is a standard Brownian motion. By the noarbitrage argument, the present value of a derivative should be
  </p>
  <p block-type="Equation">
   <math display="block">
    V(x) = E[\Phi(X_T)|X_0 = x] \tag{2}
   </math>
  </p>
  <p block-type="Text">
   where
   <math display="inline">
    \Phi
   </math>
   is the (discounted) payoff function. For notation at simplicity, we restrict attention to scalar
   <math display="inline">
    X
   </math>
   and such
   <math display="inline">
    \Phi
   </math>
   that depends only on
   <math display="inline">
    X_T
   </math>
   in the article. Then, the delta of such a model is defined as
   <math display="inline">
    dV(x)/dx
   </math>
   .
  </p>
  <p block-type="Text">
   The simplest and crudest approach to the Monte Carlo estimation of greeks is via finite-difference approximation. In other words, we simulate the derivative prices at two or more values of the underlying parameter and then estimate greeks by taking difference quotients between these values. Finite-difference estimators are easy to implement, but are prone to large bias, large variance, and added computational requirements.
  </p>
  <p block-type="Text">
   To overcome the shortages of the finite-difference method, traditionally there have been two categories
  </p>
  <p block-type="TextInlineMath">
   of methods for estimating sensitivities: methods that differentiate paths and methods that differentiate densities. The former one is known as the
   <i>
    pathwise derivative method
   </i>
   or the infinitesimal perturbation analysis in the literature and the latter is usually referred to as the likelihood ratio method (see
   <b>
    Monte
   </b>
   Carlo Greeks). Both of them yield unbiased estimators. But the former requires smooth conditions on the payoff function
   <math display="inline">
    \Phi
   </math>
   . It fails to provide any sensible estimators for options with discontinuous payoff functions such as digital options. The estimator produced by the latter involves the transition density function of
   <math display="inline">
    X_T
   </math>
   , which is unavailable in most circumstances when the dynamics
   <math display="inline">
    (1)
   </math>
   is not trivial.
  </p>
  <h4>
   <b>
    Method of Integration by Parts
   </b>
  </h4>
  <p block-type="Text">
   Fourni√©
   <i>
    et al.
   </i>
   [7, 8] developed an approach to bypass both the difficulties the traditional methods encounter. It is based on the
   <i>
    integration-by-parts
   </i>
   formula, which lies at the heart of the theory of the Malliavin calculus. Here, we state several relevant conclusions only and leave readers with interest to find more on the detailed and rigorous treatment of the Malliavin calculus and the related financial applications in Nualart [11] and Malliavin and Thalmaier [10]. For notational simplicity, we use the scalar case only in the article to demonstrate the basic idea of the method and refer readers to the relevant literature for more general and rigorous treatments.
  </p>
  <p block-type="TextInlineMath">
   Let
   <math display="inline">
    \{W_t : 0 \le t \le T\}
   </math>
   be a standard Brownian motion defined on a probability space
   <math display="inline">
    (\Omega, \mathcal{F}, P)
   </math>
   and let
   <math display="inline">
    \{\mathcal{F}_t : 0 &lt; t &lt; T\}
   </math>
   be the filtration generated by W. Consider a random variable
   <math display="inline">
    F
   </math>
   of the form
  </p>
  <p block-type="Equation">
   <math display="block">
    F = f\left(\int_0^T h_u \, \mathrm{d}W_u\right) \tag{3}
   </math>
  </p>
  <p block-type="TextInlineMath">
   where
   <math display="inline">
    f
   </math>
   is a real function with some proper smoothness and
   <math display="inline">
    \{h_u: 0 \le t \le T\}
   </math>
   is an
   <math display="inline">
    L^2[0, T]
   </math>
   valued stochastic process on
   <math display="inline">
    (\Omega, \mathcal{F}, P)
   </math>
   . The Malli
   <i>
    avin derivative
   </i>
   of
   <math display="inline">
    F
   </math>
   is defined as a stochastic process
   <math display="inline">
    DF = \{D_t F : 0 \le t \le T\}
   </math>
   , where
  </p>
  <p block-type="Equation">
   <math display="block">
    D_t F = f' \left( \int_0^T h_u \, \mathrm{d} W_u \right) \cdot h_t \tag{4}
   </math>
  </p>
  <p block-type="TextInlineMath">
   Notice that
   <math display="inline">
    \int_0^T h_u dW_u
   </math>
   is defined as the limiting summation
   <math display="inline">
    \sum_{u &lt; T} h_u \cdot dW_u := \sum_{u &lt; T} h_u \cdot (W_{u+du} - W_u)
   </math>
   .
  </p>
  <p block-type="TextInlineMath">
   So, one can view the Malliavin derivative as an ordinary derivative of the random variable
   <math display="inline">
    F
   </math>
   with respect to
   <math display="inline">
    dW_t
   </math>
   , the small increment of the Brownian motion over
   <math display="inline">
    [t, t + dt]
   </math>
   , heuristically.
  </p>
  <p block-type="TextInlineMath">
   The Malliavin derivative satisfies the chain rule as the ordinary derivative, that is, for any differentiable real function
   <math display="inline">
    \phi
   </math>
   ,
   <math display="inline">
    D\phi(F) = \phi'(F) \cdot DF
   </math>
   . Apply
   <math display="inline">
    D_t
   </math>
   on
   <math display="inline">
    X_T
   </math>
   defined by the SDE (1). Recall that
  </p>
  <p block-type="Equation">
   <math display="block">
    X_T = X_t + \int_t^T \mu(X_u) \, \mathrm{d}u + \int_t^T \sigma(X_u) \, \mathrm{d}W_u \quad (5)
   </math>
  </p>
  <p block-type="TextInlineMath">
   <math display="inline">
    X_t
   </math>
   depends only on the Brownian increments before t. Thus,
   <math display="inline">
    D_t X_t = 0
   </math>
   . By the chain rule,
   <math display="inline">
    D_t\left(\int_t^T \mu(X_u) \, \mathrm{d}u\right) = \int_t^T \mu'(X_u) \cdot D_t X_u \, \mathrm{d}u.
   </math>
   And
  </p>
  <p block-type="Equation">
   <math display="block">
    D_{t} \left( \int_{t}^{T} \sigma(X_{u}) \, \mathrm{d}W_{u} \right)
   </math>
   <br/>
   <math display="block">
    = D_{t}(\sigma(X_{t}) \, \mathrm{d}W_{t} + \int_{t+\mathrm{d}t}^{T} \sigma(X_{u}) \, \mathrm{d}W_{u})
   </math>
   <br/>
   <math display="block">
    = \sigma(X_{t}) + \int_{t+\mathrm{d}t}^{T} \sigma'(X_{u}) \cdot D_{t}X_{u} \, \mathrm{d}W_{u} \qquad (6)
   </math>
  </p>
  <p block-type="Text">
   So we have
  </p>
  <p block-type="Equation">
   <math display="block">
    D_t X_T = \sigma(X_t) + \int_t^T \mu'(X_u) \cdot D_t X_u \, \mathrm{d}u
   </math>
   <math display="block">
    + \int_t^T \sigma'(X_u) \cdot D_t X_u \, \mathrm{d}W_u \qquad (7)
   </math>
  </p>
  <p block-type="TextInlineMath">
   On the other hand, if one introduces a new process
   <math display="inline">
    Y
   </math>
   such that it is the derivative of
   <math display="inline">
    X
   </math>
   with respect to its initial value, that is,
   <math display="inline">
    Y_t = dX_t/dx
   </math>
   , then
  </p>
  <p block-type="Equation">
   <math display="block">
    dY_t = \mu'(X_t)Y_t \, dt + \sigma'(X_t)Y_t \, dW_t, \ Y_0 = 1 \quad (8)
   </math>
  </p>
  <p block-type="TextInlineMath">
   Comparing equations
   <math display="inline">
    (7)
   </math>
   and
   <math display="inline">
    (8)
   </math>
   , we can see the process
   <math display="inline">
    \{D_t X_u : t \le u \le T\}
   </math>
   should follow the same SDE as
   <math display="inline">
    Y
   </math>
   but with different initial value at
   <math display="inline">
    t
   </math>
   . Thus,
  </p>
  <p block-type="Equation">
   <math display="block">
    D_t X_T = \frac{Y_T}{Y_t} \cdot \sigma(X_t) \tag{9}
   </math>
  </p>
  <p block-type="Text" class="has-continuation">
   One of the most important properties of the Malliavin derivative is the following duality property:
  </p>
  <p block-type="TextInlineMath">
   given a process
   <math display="inline">
    h = \{h_t : 0 \le t \le T\}
   </math>
   , there exists a random variable
   <math display="inline">
    D^*(h)
   </math>
   such that
  </p>
  <p block-type="Equation">
   <math display="block">
    E\left[\int_0^T D_t \Phi(X_T) \cdot h_t \, \mathrm{d}t\right] = E[\Phi(X_T) \cdot D^*(h)] \tag{10}
   </math>
  </p>
  <p block-type="TextInlineMath">
   for all functions
   <math display="inline">
    \Phi
   </math>
   with some proper smoothness conditions. Viewing
   <math display="inline">
    D^*
   </math>
   as a "derivative" in the weak sense‚Äîrecall that the weak derivative in the PDE theory is defined in this way‚Äîone can see that equation
   <math display="inline">
    (10)
   </math>
   is exactly an analog to the integrationby-parts formula in the ordinary calculus. In the literature,
   <math display="inline">
    D^*
   </math>
   is called the Skorohod integral. It is easy to show that
   <math display="inline">
    D^*(h)
   </math>
   should be equal to the Ito integral
   <math display="inline">
    \int_0^T h_u dW_u
   </math>
   if h is adapted to the filtration
   <math display="inline">
    \mathcal{F}_t
   </math>
   .
  </p>
  <p block-type="TextInlineMath">
   Equation
   <math display="inline">
    (10)
   </math>
   is the cornerstone for the development of unbiased greeks estimators. Turn back to the derivation of unbiased estimators for the delta. Consider a smooth payoff function
   <math display="inline">
    \Phi
   </math>
   first. Choose
   <math display="inline">
    h_t \equiv
   </math>
   <math display="inline">
    \frac{1}{T}(Y_t/\sigma(X_t))
   </math>
   , which is adapted, in equation (10). By the chain rule of
   <math display="inline">
    D
   </math>
   , the left-hand side of equation
   <math display="inline">
    (10)
   </math>
   is
  </p>
  <p block-type="Equation">
   <math display="block">
    E\left[\int_{0}^{T} D_{t} \Phi(X_{T}) \cdot h_{t} \, \mathrm{d}t\right]
   </math>
   <br/>
   <math display="block">
    = E\left[\int_{0}^{T} \Phi'(X_{T}) \cdot D_{t} X_{T} \cdot \frac{1}{T} \frac{Y_{t}}{\sigma(X_{t})} \, \mathrm{d}t\right]
   </math>
   <br/>
   <math display="block">
    = E[\Phi'(X_{T}) \cdot Y_{T}] \tag{11}
   </math>
  </p>
  <p block-type="Text">
   where the last step uses equation
   <math display="inline">
    (9)
   </math>
   . The right hand side of equation
   <math display="inline">
    (10)
   </math>
   equals
  </p>
  <p block-type="Equation">
   <math display="block">
    E\left[\Phi(X_T) \cdot \frac{1}{T} \int_0^T \frac{Y_t}{\sigma(X_t)} \, \mathrm{d}W_t\right] \tag{12}
   </math>
  </p>
  <p block-type="Text">
   So,
  </p>
  <p block-type="Equation">
   <math display="block">
    E[\Phi'(X_T) \cdot Y_T] = E\left[\Phi(X_T) \cdot \frac{1}{T} \int_0^T \frac{Y_t}{\sigma(X_t)} \, \mathrm{d}W_t\right] \tag{13}
   </math>
  </p>
  <p block-type="TextInlineMath">
   Using the pathwise derivative method, we can easily derive that
   <math display="inline">
    \Phi'(X_T) \cdot Y_T
   </math>
   is an unbiased estimator of the delta. Therefore we have another unbiased estimator
  </p>
  <p block-type="Equation">
   <math display="block">
    \frac{\mathrm{d}V}{\mathrm{d}x} = E\left[\Phi(X_T) \cdot \frac{1}{T} \int_0^T \frac{Y_t}{\sigma(X_t)} \,\mathrm{d}W_t\right] \quad (14)
   </math>
  </p>
  <p block-type="TextInlineMath">
   For any nonsmooth
   <math display="inline">
    \Phi
   </math>
   such that
   <math display="inline">
    E[(\Phi(X_T))^2] &lt;
   </math>
   <math display="inline">
    +\infty
   </math>
   , we can always find a sequence of differentiable
   <math display="inline">
    \Phi^{(n)}
   </math>
   convergent to it in
   <math display="inline">
    L^2
   </math>
   , that is,
   <math display="inline">
    E[\|\Phi^{(n)}(X_T)  \Phi(X_T)
   </math>
   <math display="inline">
    ||^2|X_0 = x] \to 0
   </math>
   as
   <math display="inline">
    n \to +\infty
   </math>
   for all x. Let
   <math display="inline">
    V^{(n)}(x) = E[\Phi^{(n)}(X_T)|X_0 = x].
   </math>
   Following the above arguments,
  </p>
  <p block-type="Equation">
   <math display="block">
    \frac{\mathrm{d}V^{(n)}}{\mathrm{d}x} = E\left[\Phi^{(n)}(X_T) \cdot \frac{1}{T} \int_0^T \frac{Y_t}{\sigma(X_t)} \,\mathrm{d}W_t\right] \tag{15}
   </math>
  </p>
  <p block-type="TextInlineMath">
   Using the Cauchy‚ÄìSchwartz inequality, we can easily show that the right-hand side of equation (15) converges to
   <math display="inline">
    E\left[\Phi(X_T) \cdot \frac{1}{T} \int_0^T \frac{Y_t}{\sigma(X_t)} dW_t\right]
   </math>
   . Thus, equation (14) should hold for such
   <math display="inline">
    \Phi
   </math>
   too. The advantage of such an estimator is that it does not involve the density functions of
   <math display="inline">
    X_T
   </math>
   nor does it require
   <math display="inline">
    \Phi
   </math>
   to be smooth.
  </p>
  <h4>
   <b>
    Implementation and Some Extensions
   </b>
  </h4>
  <p block-type="TextInlineMath">
   To implement equation (14), we discretize
   <math display="inline">
    [0, T]
   </math>
   into grids:
   <math display="inline">
    0 = t_0 &lt; t_1 &lt; \cdots &lt; t_N = T
   </math>
   , where
   <math display="inline">
    t_i =
   </math>
   <math display="inline">
    iT/N
   </math>
   . Simulate the underlying process X and the derivative process
   <math display="inline">
    Y
   </math>
   simultaneously by
  </p>
  <p block-type="Equation">
   <math display="block">
    \hat{X}_{t_i} = \hat{X}_{t_{i-1}} + \mu(\hat{X}_{t_{i-1}})\Delta t + \sigma(\hat{X}_{t_{i-1}})\Delta W_i,\n
   </math>
   <math display="block">
    \n\hat{X}_0 = x\n
   </math>
   (16)
  </p>
  <p block-type="Equation">
   <math display="block">
    \hat{Y}_{t_i} = \hat{Y}_{t_{i-1}} + \mu'(\hat{X}_{t_{i-1}})\hat{Y}_{t_{i-1}}\Delta t + \sigma'(\hat{X}_{t_{i-1}})\hat{Y}_{t_{i-1}}\Delta W_i,\n
   </math>
   <math display="block">
    \n\hat{Y}_0 = 1\n
   </math>
   (17)
  </p>
  <p block-type="TextInlineMath">
   and
   <math display="inline">
    \Delta W_i = W_{t_i} - W_{t_{i-1}} \sim
   </math>
   where
   <math display="inline">
    \Delta t = T/N
   </math>
   <math display="inline">
    N(0, \Delta t)
   </math>
   . Then, approximately we have a delta estimator
  </p>
  <p block-type="Equation">
   <math display="block">
    \Phi(\hat{X}_T) \cdot \frac{1}{T} \sum_{i=1}^{N} \frac{\hat{Y}_{t_{i-1}}}{\sigma(\hat{X}_{t_{i-1}})} \Delta W_i \tag{18}
   </math>
  </p>
  <p block-type="Text">
   All the above derivations can be generalized to the cases in which
   <math display="inline">
    X
   </math>
   and
   <math display="inline">
    W
   </math>
   are both vectors, which has been shown by Fourni√©
   <i>
    et al.
   </i>
   [7]. They also established unbiased estimators for other greeks for European style options contingent on multidimensional underlying assets, such as the vega, the price sensitivity with respect to the underlying volatility; the rho, the sensitivity with respect to the riskless interest rate; the gamma, the second-order sensitivity with respect
  </p>
  <p block-type="Text">
   to the underlying price. One crucial assumption they needed is that the underlying model is elliptic, that is,
   <math display="inline">
    \sigma(x)
   </math>
   is a symmetric positive definite matrix function.
  </p>
  <p block-type="Text">
   It is worth mentioning that the integration-by-parts method is still applicable for the market where the ellipticity assumption does not hold. For instance, the interest rate market has a high-dimensional state space constituted by the values of bonds at a large number of distinct maturities and a lowdimensionality variance driven by a few noise sources (Brownian motions). Under this setting,
   <math display="inline">
    \sigma(x)
   </math>
   cannot be positive definite because it has more rows than columns. Malliavin and Thalmaier [10] provide the details on how to develop the corresponding unbiased estimators.
  </p>
  <p block-type="Text">
   A lot of research has already been done so far in the literature to extend the seminal work of Fourni√© et al. [7]. Among others, Davis and Johansson [5], El-Khatib and Privault [6], and Bally et al. [1] considered greeks in a market driven by jump-diffusion processes; Gobet and Kohatsu-Higa [9], Bernis et al. [3] derived greek estimators for lookback and barrier options; Bally
   <i>
    et al.
   </i>
   [2] applied the Malliavin calculus method to pricing and hedging American options.
  </p>
  <p block-type="Text">
   As shown here, Malliavin estimators have been derived directly for diffusion processes, but implementation typically requires simulation of a discretetime approximation. This raises the question of whether one should discretize first and then differentiate, or differentiate first and then discretize. Chen and Glasserman [4] illustrated that both approaches will lead to the same estimators in several important cases, but the first approach uses only elementary techniques such as likelihood ratio and pathwise derivative methods.
  </p>
  <h4>
   Acknowledgments
  </h4>
  <p block-type="Text">
   The author thanks Arturo Kohatsu-Higa, Eckhard Platen, Peter Jaeckel, and David Yao for their suggestions and comments in the preparation of this article.
  </p>
  <h4>
   References
  </h4>
  <p block-type="Text">
   [1] Bally, V., Bavouzet, M.-P. &amp; Messaoud, M. (2007). Integration by parts formula for locally smooth laws and applications to sensitivity computations, Annals of Applied Probability 17, 33-66.
  </p>
  <h2>
   <b>
    4 Sensitivity Computations: Integration by Parts
   </b>
  </h2>
  <p block-type="ListGroup" class="has-continuation">
   <ul>
    <li block-type="ListItem">
     [2] Bally, V., Caramellino, L. &amp; Zanette, A. (2005). Pricing and hedging American options by Monte Carlo methods using a Malliavin calculus approach,
     <i>
      Monte Carlo Methods and Applications
     </i>
     <b>
      11
     </b>
     , 97‚Äì133.
    </li>
    <li block-type="ListItem">
     [3] Bernis, G., Gobet, E. &amp; Kohatsu-Higa, A. (2003). Monte Carlo evaluation of greeks for multidimensional barrier and lookback options,
     <i>
      Mathematical Finance
     </i>
     <b>
      13
     </b>
     , 99‚Äì113.
    </li>
    <li block-type="ListItem">
     [4] Chen, N. &amp; Glasserman, P. (2007). Malliavin greeks without Malliavin calculus,
     <i>
      Stochastic Processes and their Applications
     </i>
     <b>
      117
     </b>
     , 1689‚Äì1723.
    </li>
    <li block-type="ListItem">
     [5] Davis, M.H.A. &amp; Johansson, M.P. (2006). Malliavin Monte Carlo greeks for jump diffusions,
     <i>
      Stochastic Processes and their Applications
     </i>
     <b>
      116
     </b>
     , 101‚Äì129.
    </li>
    <li block-type="ListItem">
     [6] El-Khatib, Y. &amp; Privault, N. (2004). Computations of greeks in a market with jumps via the Malliavin calculus,
     <i>
      Finance and Stochastics
     </i>
     <b>
      8
     </b>
     , 161‚Äì179.
    </li>
    <li block-type="ListItem">
     [7] Fournie, E., Lasry, J.-M., Lebuchoux, J., Lions, P.-L. &amp; ¬¥ Touzi, N. (1999). Applications of Malliavin calculus to Monte Carlo methods in finance,
     <i>
      Finance and Stochastics
     </i>
     <b>
      3
     </b>
     , 391‚Äì412.
    </li>
   </ul>
  </p>
  <p block-type="ListGroup">
   <ul>
    <li block-type="ListItem">
     [8] Fournie, E., Lasry, J.-M., Lebuchoux, J., Lions, P.-L. &amp; ¬¥ Touzi, N. (2001). Applications of Malliavin calculus to Monte Carlo methods in finance. II,
     <i>
      Finance and Stochastics
     </i>
     <b>
      5
     </b>
     , 201‚Äì236.
    </li>
    <li block-type="ListItem">
     [9] Gobet, E. &amp; Kohatsu-Higa, A. (2003). Computation of greeks for barrier and look-back options using Malliavin Calculus,
     <i>
      Electronic Communications in Probability
     </i>
     <b>
      8
     </b>
     , 51‚Äì62.
    </li>
    <li block-type="ListItem">
     [10] Malliavin, P. &amp; Thalmaier, A. (2006).
     <i>
      Stochastic calculus of Variations in Mathematical Finance
     </i>
     , Springer.
    </li>
    <li block-type="ListItem">
     [11] Nualart, D. (2006).
     <i>
      The Malliavin Calculus and Related Topics
     </i>
     , 2nd Edition, Springer.
    </li>
   </ul>
  </p>
  <h2>
   <b>
    Related Articles
   </b>
  </h2>
  <p block-type="Text">
   <b>
    Monte Carlo Greeks
   </b>
   ;
   <b>
    Stochastic Differential Equations: Scenario Simulation
   </b>
   .
  </p>
  <p block-type="Text">
   NAN CHEN
  </p>
 </body>
</html>
