# **Stochastic Differential Equations: Scenario** Simulation

#### **Discrete-time Approximation**

We have explicit solutions only in a few cases of stochastic differential equation (SDEs), including linear SDEs and their transformations. In finance, it is often helpful, and in some situations essential, to be able to simulate accurate trajectories of solutions of SDEs that model the financial quantities under consideration. These scenarios are typically generated by algorithms that use pseudorandom number generators, as introduced in Pseudorandom Number Generators. However, one can use also historical returns, log-returns, or increments from observed asset prices as input in a simulation that is then called a historical simulation. In the following, we give a basic introduction into scenario simulation. Here, we approximate the path of a solution of a given SDE by the path of a discrete-time approximation, simulated by using random number generators, see Pseudorandom Number Generators. For books on scenario simulation of solutions of SDEs we refer to [7, 8]. There exists also an increasing literature on simulation methods in finance. Important monographs that the reader can be referred to include [5, 6].

Consider a given discretization  $0 = \tau_0 < \tau_1 <$  $\cdots < \tau_n < \cdots < \tau_N = T$  of the time interval [0, T]. We shall approximate a diffusion process  $X =$  $\{X_t, t \in [0, T]\}$  satisfying the one-dimensional SDE

$$dX_t = a(t, X_t) dt + b(t, X_t) dW_t$$
(1)

on  $t \in [0, T]$  with initial value  $X_0 \in \mathbb{R}$ .

Let us first introduce one of the simplest discretetime approximations, the Euler scheme or Euler-Maruyama scheme, see [9]. An Euler approxima*tion* is a continuous-time stochastic process  $Y^{\Delta}$  =  $\{Y_t^{\Delta}, t \in [0, T]\}$  satisfying the recursive scheme

$$Y_{n+1} = Y_n + a(\tau_n, Y_n) (\tau_{n+1} - \tau_n)$$
  
+  $b(\tau_n, Y_n) (W_{\tau_{n+1}} - W_{\tau_n})$  (2)

for  $n \in \{0, 1, \ldots\}$  with initial value

$$Y_0 = Y_0^{\Delta} = X_0 \tag{3}$$

For convenience, we write

$$Y_n = Y_{\tau_n}^{\Delta} \tag{4}$$

for the value of the approximation at the discretization time  $\tau_n$ . We write

$$\Delta_n = \tau_{n+1} - \tau_n \tag{5}$$

for the  $n$ th increment of the time discretization and call

$$\Delta = \max_{n \in \{0, 1, \dots, N-1\}} \Delta_n \tag{6}$$

the maximum step size. We consider here, for simplicity, equidistant time discretizations with

$$\tau_n = n \; \Delta \tag{7}$$

for  $\Delta_n = \Delta = T/N$  and some integer N large enough so that  $\Delta \in (0, 1)$ .

The sequence  $(Y_n)_{n \in 0,1,\dots,N}$  of values of the Euler approximation (2) at the instants of the time discretization  $\tau_0, \tau_1, \ldots, \tau_N$  can be recursively computed. For this purpose, we need to generate the random increments

$$\Delta W_n = W_{\tau_{n+1}} - W_{\tau_n} \tag{8}$$

for  $n \in \{0, 1, \ldots, N-1\}$  of the Wiener process  $W =$  $\{W_t, t \in [0, T]\}$ . These increments represent independent Gaussian distributed random variables with mean

$$E\left(\Delta W_n\right) = 0\tag{9}$$

and variance

$$E\left((\Delta W_n)^2\right) = \Delta\tag{10}$$

For the increments  $(8)$  of the Wiener process we can use a sequence of independent Gaussian pseudorandom numbers. These can be generated, for instance, as suggested in Pseudorandom Number Generators.

For describing a numerical scheme efficiently, we typically use the abbreviation

$$f = f(\tau_n, Y_n) \tag{11}$$

for a function  $f$  defined on  $[0, T] \times \mathbb{R}^d$  and  $n \in$  $\{0, 1, \ldots, N-1\}$ , when no misunderstanding is possible. We can then rewrite the Euler scheme (2) in the form

$$Y_{n+1} = Y_n + a \Delta + b \Delta W_n \tag{12}$$

for  $n \in \{0, 1, \ldots, N-1\}$ . Usually, we suppress the mentioning of the initial condition, where we typically set

$$Y_0 = X_0 \tag{13}$$

The recursive structure of the Euler scheme, which generates approximate values of the diffusion process  $X$  at the discretization times only, is the key to its implementation.

#### Interpolation

We emphasize that we shall consider a discretetime approximation to be a stochastic process defined on the interval  $[0, T]$ . Although it will be often sufficient to generate its values at the discretization times, if required, values at the intermediate instants can be determined by an appropriate interpolation method. The simplest one is the *piecewise constant* interpolation with

$$Y_t^{\Delta} = Y_{n_t} \tag{14}$$

for  $t \in [0, T]$ . Here  $n_t$  is the integer defined by

$$n_t = \max\{n \in 0, 1, \dots, N : \tau_n \le t\} \tag{15}$$

which is the largest integer *n* for which  $\tau_n$  does not exceed  $t$ .

Furthermore, the *linear interpolation* 

$$Y_t^{\Delta} = Y_{n_t} + \frac{t - \tau_{n_t}}{\tau_{n_t+1} - \tau_{n_t}} \left( Y_{n_t+1} - Y_{n_t} \right) \tag{16}$$

for  $t \in [0, T]$  is often used in the visualization of trajectories because it provides continuous sample paths in a convenient and realistic manner.

In general, the sample paths of a diffusion process inherit some properties of the trajectory of its driving Wiener process, in particular, its nondifferentiability. It is impossible to fully reproduce on a digital computer the microstructure of such path in a scenario simulation. Thus, we shall concentrate on simulating values of a discrete-time approximation at given discretization times and interpolate these appropriately if needed.

# **Simulating Geometric Brownian Motion**

To illustrate various aspects of a scenario simulation *via* a discrete-time approximation of a diffusion process, it is useful to examine, in some detail, a simple but important example with an explicit solution. In finance, one often faces growth processes. These are under the standard market model usually interpreted as geometric Brownian motions. Let us consider the geometric Brownian motion  $X = \{X_t, t \in [0, T]\}$ satisfying the linear SDE

$$dX_t = a X_t dt + b X_t dW_t \tag{17}$$

for  $t \in [0, T]$  with initial value  $X_0 > 0$ . This model is also known as the Black-Scholes model. The geometric Brownian motion  $X$  is a diffusion process with *drift coefficient* 

$$a(t, x) = a x \tag{18}$$

and diffusion coefficient

$$b(t,x) = bx \tag{19}$$

Here *a* denotes the *appreciation rate* and  $b \neq 0$  the *volatility*. It is well known that the SDE (17) has the explicit solution

$$X_t = X_0 \exp\left\{ \left( a - 1/2 \, b^2 \right) t + b \, W_t \right\} \tag{20}$$

for  $t \in [0, T]$  and given Wiener process  $W = \{W_t,$  $t \in [0, T]$ . The availability of an explicit solution makes the simulation an easy task because the solution of the SDE  $(17)$  is simply the exponential function (20) of the corresponding Wiener process value.

## **Simulation of Approximate Trajectories**

Knowing the solution  $(20)$  of the SDE  $(17)$  explicitly gives us the possibility of comparing the Euler approximation  $Y$ , see equation (12), with the exact solution  $X$ . Of course, in general, this is not possible.

To simulate a trajectory of the Euler approximation for a given time discretization, we start from the initial value  $Y_0 = X_0$ , and proceed recursively by generating the next value

$$Y_{n+1} = Y_n + a Y_n \Delta + b Y_n \Delta W_n \tag{21}$$

for  $n \in \{0, 1, \ldots, N-1\}$  according to the Euler scheme  $(12)$  with drift coefficient  $(18)$  and diffusion coefficient (19). Here

$$\Delta W_n = W_{\tau_{n+1}} - W_{\tau_n} \tag{22}$$

see equation (8), is the  $N(0, \Delta)$  Gaussian distributed increment of the Wiener process  $W$  over the interval  $[\tau_n, \tau_n + \Delta]$ , which we generate by a pseudorandom number generator, see Pseudorandom Number Generators.

For comparison, we can use the equation  $(20)$  for the given Black-Scholes dynamics to determine the corresponding exact values of the solution. This uses the same sample path of the Wiener process in equation (20), as employed by the Euler scheme (21), where one obtains as explicit solution at time  $\tau_n$  the value

$$X_{\tau_n} = X_0 \exp\left\{ \left( a - 1/2 \, b^2 \right) \tau_n + b \sum_{i=1}^n \Delta W_{i-1} \right\} \tag{23}$$

for  $n \in \{0, 1, \ldots, N-1\}.$ 

One needs always to be careful when using a discrete-time approximation such as the Euler scheme (21). This is clearly a different object than the exact solution of the underlying SDE. For instance, inconsistencies may arise because the increments in the noise part of the Euler scheme can take extremely large values of either sign. Even though this can occur only with small probability, large negative stochastic increments can, for instance, make the Euler approximation  $(21)$  negative. This would be not consistent with our aim of simulating positive asset prices via the Black-Scholes model. The possibility of generating negative asset prices is quite a serious defect in the Euler method when directly applied for the Black–Scholes dynamics. For extremely small step sizes, this phenomenon becomes highly unlikely; however, it is not excluded unless one designs the simulation in a way that guarantees positivity. For the above Black-Scholes dynamics, this can be achieved by simulating first the logarithm of the geometric Brownian motion by using a corresponding Euler scheme and deriving then the approximate value of  $X$ as the exponential of the approximated logarithm. In the case of constant volatility and appreciation rate, this even yields the exact solution of the SDE at the discretization points.

## **Order of Strong Convergence**

So far we have not specified a criterion for the classification of the overall accuracy of a discrete-time approximation with respect to vanishing time step size. Such a criterion should reflect the main goal of a scenario simulation, which applies in situations where a *pathwise approximation* is required. For instance, scenario simulation is needed for the visualization of typical trajectories of financial models, the testing of calibration methods and statistical estimators, and also in filtering hidden variables. Monte Carlo simulation is discussed in **Monte Carlo Simulation** for Stochastic Differential Equations, which is different since it focuses on *approximating probabilities* and functionals of the underlying processes.

One can estimate the error of an approximation using the following *absolute error criterion*. For a given step size  $\Delta$ , it is defined as the expectation of the absolute difference between the discrete-time approximation  $Y_N = Y_T^{\Delta}$  and the solution  $X_T$  of the SDE at the time horizon  $T = N\Delta$ , that is,

$$\varepsilon(\Delta) = E\left(\left|X_T - Y_T^{\Delta}\right|\right) \tag{24}$$

This gives some measure for the pathwise closeness at the end of the time interval  $[0, T]$  as a function of the maximum step size  $\Delta$  of the time discretization.

Although the Euler approximation is one of the simplest discrete-time approximations, it is, generally, not very efficient numerically. In the following we shall, therefore, derive and investigate also other discrete-time approximations.

To classify different discrete-time approximations, we introduce their order of strong convergence. We shall say that a discrete-time approximation  $Y^{\Delta}$ *converges strongly with order*  $\gamma > 0$  at time *T* if there exists a positive constant  $C$ , which does not depend on  $\Delta$ , and a  $\delta_0 > 0$  such that

$$\varepsilon(\Delta) = E\left(\left|X_T - Y_T^{\Delta}\right|\right) \le C \,\Delta^{\gamma} \tag{25}$$

for each  $\Delta \in (0, \delta_0)$ . We call equation (25) the strong convergence criterion.

We emphasize that this criterion has been constructed for the classification of, so called, strong *approximations*. There exist in the literature results, see for instance, [7], which provide uniform error estimates and involve also higher moments than used by the criterion  $(25)$ . For instance, the supremum of the squared difference between  $X_t$  and  $Y_t^{\Delta}$  for  $t \in [0, T]$  has been estimated. The criterion  $(25)$  for the order of strong convergence appears to be natural and sufficient for the classification of schemes.

#### **Euler Scheme**

Let us now use Wagner-Platen expansions (see Stochastic Taylor Expansions), to derive discretetime approximations with respect to the criterion (25). By appropriate truncation of the expansions in each discretization step, we obtain corresponding strong Taylor schemes of given strong order of convergence. For details, we refer to [7]. Recall that we usually suppress the dependence on  $\tau_n$  and  $Y_n$  in the coefficients.

Let us begin with the already mentioned *Euler* scheme (21), which represents the simplest useful strong Taylor approximation. The *Euler scheme* has the form

$$Y_{n+1} = Y_n + a \Delta + b \Delta W_n \tag{26}$$

where  $\Delta = \tau_{n+1} - \tau_n$  is the length of the time discretization subinterval  $[\tau_n, \tau_{n+1}]$  and  $\Delta W_n = W_{\tau_{n+1}}$  –  $W_{\tau_n}$  is an  $N(0, \Delta)$  independent Gaussian distributed increment of the Wiener process W on  $[\tau_n, \tau_{n+1}]$ .

The Euler scheme corresponds to a truncated Wagner-Platen expansion that contains only single time and Wiener integrals. Assuming Lipschitz and linear growth conditions on the coefficient functions  $a$  and  $b$ , it can be shown that the Euler approximation is of strong order  $\nu = 0.5$ .

Note that in special cases, this means for specific SDEs, the Euler scheme may achieve a higher order of strong convergence. For example, if the noise is additive, that is when the diffusion coefficient is a differentiable, deterministic function of time of the form

$$b(t, x) = b_t \tag{27}$$

then the Euler scheme achieves the order of strong convergence  $\gamma = 1.0$ .

The Euler scheme gives reasonable numerical results when the drift and diffusion coefficients are almost constant and the time step size is chosen to be sufficiently small. In general, however, it is not very satisfactory. The use of higher order and numerically stable schemes is recommended, which we discuss later.

#### Milstein Scheme

We now introduce an important scheme, the *Milstein scheme*, which was first suggested in [10] and turns out to be of strong order  $\nu = 1.0$ . It is obtained by using one additional term from the Wagner-Platen expansions, see Stochastic Taylor Expansions.

The Milstein scheme has the form

$$Y_{n+1} = Y_n + a \Delta + b \Delta W_n + b b' 1/2$$
$$\times \left\{ (\Delta W_n)^2 - \Delta \right\} \tag{28}$$

We remark that for more general SDEs, involving several driving Wiener processes, multiple stochastic integrals

$$I_{(j_1,j_2)} = \int_{\tau_n}^{\tau_{n+1}} \int_{\tau_n}^{s_1} dW_{s_2}^{j_1} dW_{s_1}^{j_2} \tag{29}$$

with  $j_1 \neq j_2$  appear in the general version of the Milstein scheme. They cannot be simply expressed in terms of the increments  $\Delta W_n^{j_1}$  and  $\Delta W_n^{j_2}$  of the corresponding Wiener processes. Still, approximations are possible [4, 8]. However, in the special case  $j_1 = j_2$ we have

$$I_{(j_1,j_1)} = 1/2 \left\{ (\Delta W_n^{j_1})^2 - \Delta \right\} \tag{30}$$

which makes this double Wiener integral easy to generate.

For the Black-Scholes model and some other important dynamics in financial modeling, the corresponding SDEs have special properties which simplify the Milstein scheme. This avoids, in some cases, the use of double Wiener integrals of the type (29) involving two different Wiener processes. For instance, in the case of an SDE with additive noise, that is, when the diffusion coefficients depend at most on time  $t$  and not on the state variable, the Milstein scheme  $(28)$  reduces to the Euler scheme  $(26)$ . Another important special case is that of *commutative* noise, see [7]. For commutative noise, the coefficient functions of the double Wiener integrals  $I_{(j_1,j_2)}$  and  $I_{(j_2,j_1)}$  are the same and one can exploit the fact that  $I_{(j_1,j_2)} + I_{(j_2,j_1)} = \Delta W_n^{j_1} \Delta W_n^{j_2}.$ 

#### Order 1.5 Strong Taylor Scheme

There exist simulation tasks that require more accurate schemes than the Milstein scheme. For instance, if one wants to capture extreme asset price movements or simply needs to be more accurate in a scenario simulation, then one may use higher order strong schemes. In general, we obtain more accurate strong Taylor schemes by including into the scheme further multiple stochastic integrals from the Wagner-Platen expansion (see Stochastic Taylor **Expansions**). Each of these multiple stochastic integrals contains additional information about the sample path of the driving Wiener process. The necessity of the inclusion of further multiple stochastic integrals for achieving higher orders of convergence is a fundamental feature of stochastic numerical methods solving SDEs.

The *order 1.5 strong Taylor scheme* is of the form

$$Y_{n+1} = Y_n + a \Delta + b \Delta W_n$$
  
+  $b \, b' \, 1/2 \left\{ (\Delta W_n)^2 - \Delta \right\} + a' \, b \, \Delta Z_n$   
+  $1/2 \left( a \, a' + \frac{1}{2} \, b^2 \, a'' \right) \Delta^2$   
+  $\left( a \, b' + 1/2 \, b^2 \, b'' \right) \left\{ \Delta W_n \, \Delta - \Delta Z_n \right\}$   
+  $b \left( b \, b'' + (b')^2 \right) 1/2$   
 $\times \left\{ \frac{1}{3} \left( \Delta W_n \right)^2 - \Delta \right\} \Delta W_n$  (31)

Here the additional random variable  $\Delta Z_n$  is required, which represents the double integral

$$\Delta Z_n = I_{(1,0)} = \int_{\tau_n}^{\tau_{n+1}} \int_{\tau_n}^{s_2} \mathrm{d}W_{s_1} \, \mathrm{d}s_2 \qquad (32)$$

One can show that  $\Delta Z_n$  is Gaussian distributed with mean  $E(\Delta Z_n) = 0$ , variance  $E((\Delta Z_n)^2) = 0$  $\frac{1}{3}\Delta^3$ , and covariance  $E(\Delta Z_n \Delta W_n) = 1/2\Delta^2$ . Note that a pair of appropriately correlated Gaussian distributed random variables  $(\Delta W_n, \Delta Z_n)$  can be easily constructed by linear combination of two independent  $N(0, 1)$  standard Gaussian distributed random variables. All multiple stochastic integrals that appear in equation (31) can be expressed in terms of  $\Delta$ ,  $\Delta W_n$ , and  $\Delta Z_n$ . In particular, the last term in equation (31) contains the triple Wiener integral

$$I_{(1,1,1)} = 1/2 \left\{ 1/3 \left( \Delta W_n^1 \right)^2 - \Delta \right\} \Delta W_n^1 \qquad (33)$$

which reflects the third-order Hermite polynomial in  $\Delta W_n^1$ . The Taylor schemes of any desired strong order are described in  $[7]$ .

# An Explicit Order 1.0 Strong Scheme

Let us now consider strong schemes that avoid the use of derivatives similar to Runge-Kutta schemes for ordinary differential equations. Even though the resulting schemes look similar to Runge-Kutta methods, they cannot be simply constructed as heuristic adaptations of deterministic Runge-Kutta schemes. Appropriate *strong derivative-free schemes* have been systematically designed in  $[1, 2, 7]$ .

Various first-order derivative-free schemes can be obtained from the Milstein scheme (28) simply by replacing the derivatives in the Milstein scheme by corresponding differences. The inclusion of these differences requires the computation of supporting values of the coefficients at additional supporting points. An example is given by the following scheme, called the *order 1.0 Platen scheme*, see [7], which is of the form

$$Y_{n+1} = Y_n + a \Delta + b \Delta W_n + \frac{1}{2\sqrt{\Delta}}$$
$$\times \left\{ b(\tau_n, \bar{\Upsilon}_n) - b \right\} \left\{ (\Delta W_n)^2 - \Delta \right\} \quad (34)$$

and uses the supporting value

$$\bar{\Upsilon}_n = Y_n + a \,\Delta + b \,\sqrt{\Delta} \tag{35}$$

Multidimensional versions of this and most other schemes exist also for the case of several driving Wiener processes.

#### An Explicit Order 1.5 Strong Scheme

One can construct also derivative-free schemes of strong order  $\gamma = 1.5$  by replacing the derivatives in the order 1.5 strong Taylor scheme by corresponding finite differences. The following explicit order 1.5 strong scheme, also called order 1.5 Platen scheme, has the form

$$\begin{split} Y_{n+1} &= Y_n + b \,\Delta W_n + \frac{1}{2\sqrt{\Delta}} \\ &\times \left\{ a(\bar{\Upsilon}_+) - a(\bar{\Upsilon}_-) \right\} \,\Delta Z_n \\ &+ \frac{1}{4} \left\{ a(\bar{\Upsilon}_+) + 2a + a(\bar{\Upsilon}_-) \right\} \,\Delta \\ &+ \frac{1}{4\sqrt{\Delta}} \left\{ b(\bar{\Upsilon}_+) - b(\bar{\Upsilon}_-) \right\} \left\{ (\Delta W_n)^2 - \Delta \right\} \end{split}$$

$$+\frac{1}{2\Delta} \left\{ b(\tilde{\mathsf{T}}_{+}) - 2b + b(\tilde{\mathsf{T}}_{-}) \right\}$$
$$\times \left\{ \Delta W_{n} \Delta - \Delta Z_{n} \right\}$$
$$+\frac{1}{4\Delta} \left[ b(\bar{\Phi}_{+}) - b(\bar{\Phi}_{-}) - b(\tilde{\mathsf{T}}_{+}) + b(\tilde{\mathsf{T}}_{-}) \right]$$
$$\times \left\{ \frac{1}{3} (\Delta W_{n})^{2} - \Delta \right\} \Delta W_{n} \tag{36}$$

with

and

$$\bar{\Upsilon}_{\pm} = Y_n + a \,\Delta \pm b \,\sqrt{\Delta} \tag{37}$$

$$\bar{\Phi}_{\pm} = \bar{\Upsilon}_{+} \pm b(\bar{\Upsilon}_{+})\sqrt{\Delta} \tag{38}$$

Here  $\Delta Z_n$  is the double integral  $I_{(1,0)}$  defined in equation (32). Further higher order explicit schemes with corresponding strong order of convergence can be found in  $[7]$ .

#### **Numerical Stability**

Numerical stability is very important in simulation. It can be understood as the ability of a scheme to control the propagation of errors. Such errors naturally occur in almost any simulation on a computer due to its limited precision and as a result of truncation errors in the above schemes. However, numerical methods differ in their ability to dampen the arising errors. What really matters for a scheme is that it must be numerically stable when generating sufficiently accurate results over longer time periods. Before any properties of higher order convergence can be reasonably exploited, the question of numerical stability has to be satisfactorily answered. In particular, for solutions of SDEs with multiplicative noise, which are martingales, simulation studies have shown [11] that, with the above-described explicit schemes, numerical instabilities can easily occur.

The propagation of errors depends significantly on the specific nature of the diffusion coefficient of the SDE. For general SDEs and a given scheme, it is a delicate matter to provide reasonably useful answers with respect to their numerical stability. However, it is very helpful to study representative classes of test equations. Each particular type of SDEs usually has its own numerical challenges. Test SDEs can reveal typical numerical instabilities and allow the design of appropriate schemes. For SDEs with additive noise,

that is, SDEs with deterministic diffusion coefficients, the following concept of *A*-stability can be applied. We use here a real-valued test SDE with additive noise of the form

$$dX_t = \lambda X_t dt + dW_t \tag{39}$$

for  $\lambda \in \mathbb{R}$ . Obviously,  $X_t$  forms an Ornstein-Uhlenbeck process, which has a stationary density for  $\lambda < 0$ . A discrete-time approximation Y, when applied to the test equation  $(39)$ , typically yields a recursive relation of the form

$$Y_{n+1} = G^A(\lambda \; \Delta) \; Y_n + Z_n \tag{40}$$

Here, the random term  $Z_n$  is assumed not to depend on  $Y_0, Y_1, \ldots, Y_n, Y_{n+1}$ , and we call  $G^A(\lambda \Delta)$  the transfer function of the scheme.

Now, the A-stability region of a given scheme is defined as the subset of the real axis consisting of those numbers  $\lambda \Delta$ , which are mapped by the *transfer* function  $G^{A}(\cdot)$  into the unit interval  $(-1, 1)$ . These are those  $\lambda\Delta$  for which

$$|G^A(\lambda \,\Delta)| < 1\tag{41}$$

If, for a scheme, the  $A$ -stability region covers the left half of the real axis, that is the part formed by all  $\lambda \Delta$ with  $\lambda < 0$ , then we say that the scheme is *A*-stable. In this case, the scheme achieves numerical stability for those parameters where the test dynamics themselves show stability. Since we have used additive noise in the test equation (39) we interpret  $A$ -stability here as *additive noise stability*. Let us now examine some implicit strong schemes.

## **Drift Implicit Euler and Milstein Schemes**

The simplest implicit strong scheme is the *drift implicit Euler scheme*, which has strong order  $\gamma =$  $0.5$ . It has the form

$$Y_{n+1} = Y_n + a (\tau_{n+1}, Y_{n+1}) \Delta + b \Delta W_n \qquad (42)$$

Here we follow our convention in writing  $b =$  $b(\tau_n, Y_n)$ . There is also a family of drift implicit Euler schemes

$$Y_{n+1} = Y_n + \{ \alpha \ a \ (\tau_{n+1}, Y_{n+1})$$
  
+ (1 - \alpha) \ a \} \ \Delta + b \ \Delta W (43)

where the parameter  $\alpha \in [0, 1]$  characterizes the *degree of implicitness.* Note that for  $\alpha = 0$  we have the explicit Euler scheme (26) and for  $\alpha = 1$  the drift implicit Euler scheme (42). For  $\alpha = 0.5$ , we obtain from (43) a stochastic generalization of the deterministic trapezoidal method.

For the test equation (39), the family of drift implicit Euler schemes with degree of implicitness  $\alpha \in [0, 1]$  yields the recursion formula

$$Y_{n+1} = Y_n + \{ \alpha \lambda Y_{n+1} + (1 - \alpha) \lambda Y_n \} \Delta + \Delta W_n$$
(44)

and thus

$$Y_{n+1} = G^{A}(\lambda \Delta) Y_{n} + \Delta W_{n} (1 - \alpha \lambda \Delta)^{-1} \quad (45)$$

with transfer function

$$G^{A}(\lambda \Delta) = (1 - \alpha \lambda \Delta)^{-1} (1 + (1 - \alpha) \lambda \Delta)$$
(46)

If we denote by  $\bar{Y}_{n+1}$ , the corresponding discrete-time approximation that starts at the initial value  $\bar{Y}_0$  instead of  $Y_0$ , then we obtain for the difference

$$Y_{n+1} - \bar{Y}_{n+1} = G^{A}(\lambda \ \Delta) (Y_{n} - \bar{Y}_{n})$$
  
=  $(G^{A}(\lambda \ \Delta))^{n} (Y_{0} - \bar{Y}_{0})$  (47)

Obviously, as long as the absolute value of the transfer function  $G^{A}(\lambda \Delta)$  is smaller than 1, that is

$$|G^A(\lambda \,\Delta)| < 1\tag{48}$$

the impact of the initial error  $|Y_0 - \bar{Y}_0|$  is decreased during the simulation of the approximate trajectory over time, as can be seen from equation (47). However, for values

$$|G^A(\lambda \Delta)| > 1 \tag{49}$$

this is not the case, and errors are propagated. For the above test equation, it turns out that the region of A-stability ranges from  $-2/(1-2\alpha)$  up to 0. This means for a degree of implicitness  $\alpha > 1/2$  the corresponding drift implicit scheme is A-stable.

We call the following counterpart of the Milstein scheme (28) a *drift implicit Milstein scheme*. It has the form

$$Y_{n+1} = Y_n + a (\tau_{n+1}, Y_{n+1}) \Delta + b \Delta W_n$$
  
+  $b b' 1/2 \{ (\Delta W_n)^2 - \Delta \}$  (50)

There exist further families of drift implicit strong schemes of higher order. Some of these are A-stable and can be found in  $[7]$ .

# **Drift Implicit Order 1.0 Strong** Runge-Kutta Scheme

Let us now discuss a family of drift implicit schemes which avoid the use of derivatives. We shall call these drift implicit strong Runge-Kutta schemes. We emphasize that these schemes are not a simple heuristic adaptation of any deterministic Runge-Kutta scheme.

A family of drift implicit order 1.0 strong Runge-Kutta schemes is given as

$$Y_{n+1} = Y_n + \{ \alpha \, a \left( \tau_{n+1}, Y_{n+1} \right) + (1 - \alpha) \, a \} \, \Delta$$
  
+ 
$$b \, \Delta W_n + \frac{1}{\sqrt{\Delta}} \left\{ b \left( \tau_n, \bar{\Upsilon}_n \right) - b \right\}$$
  
$$\times \frac{1}{2} ((\Delta W_n)^2 - \Delta) \tag{51}$$

with supporting value

$$\bar{\Upsilon}_n = Y_n + a \,\Delta + b \,\sqrt{\Delta} \tag{52}$$

and degree of implicitness parameter  $\alpha \in [0, 1]$ . Further implicit schemes and the derivations of their strong order of convergence can be also found in [7].

#### **Balanced Implicit Method**

A major difficulty arises from the fact that all the above strong schemes do not provide implicit expressions in the diffusion terms. Only drift terms are made implicit. Unfortunately, one cannot make diffusion terms in the Euler scheme simply implicit as it was possible for the drift. An *ad hoc* implicit discrete-time approximation with implicit diffusion term would result in a scheme that includes the inverse of a Gaussian random variable. Such an algorithm may explode and, thus, does not provide a reasonable scheme.

Drift implicit methods are well adapted for systems with small noise or additive noise. However, when the diffusion part plays an essential role in the dynamics, as it is the case for martingales,

the application of fully implicit methods, involving also implicit diffusion terms, could bring numerical stability.

An illustration for such a situation is provided by the one-dimensional SDE of an exponential martingale

$$\mathrm{d}X_t = \sigma \ X_t \, \mathrm{d}W_t \tag{53}$$

for  $t \in [0, T]$ , starting at  $X_0 = x_0$ . Here  $W =$  $\{W_t, t \in [0, T]\}$  is a standard Wiener process. The volatility  $\sigma$  is, for simplicity, chosen to be constant. The SDE (53) describes the standard Black–Scholes dynamics of a discounted asset price under the riskneutral probability measure. Alternatively, it could describe the dynamics of a security denominated in units of the growth optimal portfolio under the realworld probability measure applying the benchmark approach [12]. These are typical dynamics that one faces when simulating asset dynamics in finance. Obviously, in such cases one cannot apply drift implicit schemes to improve the numerical stability of the approximate solution of an SDE that does not have any drift term, as is the case for the martingale satisfying the SDE (53). However, we can use implicit methods that introduce implicitness in the diffusion terms in such a way that the scheme still makes sense and converges to the correct limit.

Let us now describe such an implicit method that allows to overcome a range of numerical instabilities. In  $[11]$  a family of *balanced implicit methods* has been proposed that resolves, in many cases, the problem of numerical stability. Such a balanced implicit method can be written in the form

$$Y_{n+1} = Y_n + a \Delta + b \Delta W_n + (Y_n - Y_{n+1}) C_n, \quad (54)$$

where

$$C_n = c^0(Y_n) \Delta + c^1(Y_n) |\Delta W_n| \tag{55}$$

and  $c^0$ ,  $c^1$  represent positive, real-valued uniformly bounded functions. The freedom of choosing  $c^0$ and  $c^1$  can be exploited to construct a numerically stable scheme tailored for the dynamics of the given SDE. Note, however, the balanced implicit method is only of strong order  $\gamma = 0.5$  since it is a variation of the Euler scheme with some additional higher order terms designed to control the propagation of errors. The low order of strong convergence is a price that is paid here for obtaining better numerical stability.

The balanced implicit method can be interpreted as a family of strong methods, providing a kind of balance between the approximating and the higher order diffusion terms in a scenario simulation. In a range of applications in finance and filtering, see [3], balanced implicit methods have shown better numerical stability than most other methods presented above. We emphasize any numerically stable scheme is better than an unstable one. An eventually theoretically higher order of strong convergence of a scheme is only of secondary importance.

## References

- $[1]$ Burrage, K. & Burrage, P.M. (1998). General order conditions for stochastic Runge-Kutta methods for both commuting and non-commuting stochastic ordinary differential equation systems, Applied Numerical Mathematics 28,  $161-177$ .
- Burrage, K. & Platen, E. (1994). Runge-Kutta methods [2] for stochastic differential equations, Annals of Numerical Mathematics  $1(1-4)$ , 63-78.
- Fischer, P. & Platen, E. (1999). Applications of the [3] balanced method to stochastic differential equations in filtering, Monte Carlo Methods and Applications 5(1), 19-38.
- Gaines, J.G. & Lyons, T.J. (1994). Random generation [4] of stochastic area integrals, SIAM Journal on Applied Mathematics  $54(4)$ , 1132–1146.
- Glasserman, P. (2004). Monte Carlo Methods in Finan-[5] cial Engineering, Applied Mathematics, Springer, Vol. 53.
- Jäckel, P. (2002). Monte Carlo Methods in Finance, [6] Wiley.
- [7] Kloeden, P.E. & Platen E. (1999). Numerical Solution of Stochastic Differential Equations, Applied Mathematics, Springer, Vol. 23, Third printing.
- [8] Kloeden, P.E., Platen, E. & Schurz, H. (2003). Numerical Solution of SDE's Through Computer Experiments, Universitext, Springer, Third corrected printing.
- [9] Maruyama, G. (1955). Continuous Markov processes and stochastic equations, Rendiconti del Circolo Matematico di Palermo 4, 48-90.
- $[10]$ Milstein, G.N. (1974). Approximate integration of stochastic differential equations. Theory of Probability and Its Applications 19, 557-562.
- [11] Milstein, G.N., Platen, E. & Schurz, H. (1998). Balanced implicit methods for stiff stochastic systems, SIAM Journal on Numerical Analysis 35(3), 1010-1019.
- [12] Platen, E. & Heath, D. (2006). A Benchmark Approach to Quantitative Finance, Springer Finance.

**Related Articles**

**LIBOR Market Model**; **LIBOR Market Models: Simulation**; **Monte Carlo Simulation for Stochastic Differential Equations**; **Pseudorandom Number Generators**; **Simulation of Square-root Processes**; **Stochastic Integrals**; **Stress Testing**; **Variance Reduction**.

ECKHARD PLATEN & NICOLA BRUTI-LIBERATI