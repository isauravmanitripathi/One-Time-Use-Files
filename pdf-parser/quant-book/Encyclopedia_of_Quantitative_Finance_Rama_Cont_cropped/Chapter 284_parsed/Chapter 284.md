# **Expected Utility** Maximization

The continuous-time portfolio problem consists of maximizing total expected utility of consumption over the trading interval  $[0, T]$  and/or of terminal wealth  $X(T)$ . We look at this problem in the standard continuous-time diffusion market setting. In other words, we consider a security market with  $n+1$ assets, one of which is a money market account with rate of return  $r(t)$ , and the other *n* of which are stocks, whose prices are driven by an  $m$ -dimensional Brownian motion. More precisely, the prices are given as the unique solutions of the equations

$$dP_0(t) = P_0(t)r(t) dt, \quad P_0(0) = 1 \tag{1}$$
  
$$dP_i(t) = P_i(t) \left( b_i(t) dt + \sum_{j=1}^m \sigma_{ij}(t) dW_j(t) \right),$$

$$P_i(0) = p_i \tag{2}$$

Here, we assume that the market coefficients  $r, b$ , and  $\sigma$  are progressively measurable with respect to the Brownian filtration, component-wise bounded, and that  $\sigma\sigma'$  is uniformly positive definite, that is, we have

$$x'\sigma(t)\sigma(t)'x \ge c \ x'x \quad \text{a.s.} \tag{3}$$

for a positive constant c, and all  $0 \neq x \in IR^n$ ,  $t \in$  $[0, T]$ . This, in particular, implies

$$m \ge n \tag{4}$$

The investor specifies his/her investment and consumption strategy at time t by choosing the rate  $c(t)$ at which he/she consumes and the different fractions  $\pi_i(t)$  of his/her wealth that he/she invests in the risky asset  $i$ . The remaining fraction of his/her wealth  $1 - \sum_{i=1}^{n} \pi_i(t)$  has to be invested in the money market account. We assume that the investor bases his investment decisions on the observation of past and present security prices. We therefore require both the consumption and the portfolio process to be progressively measurable with respect to the filtration  $(f_t)_{t\in[0,T]}$  generated by the security prices. Of course, the consumption should always be nonnegative. We define the investor's wealth process  $X^{\pi,c}(t)$  using the strategy  $(\pi, c)$  as the sum of the value of his/her total

holdings at time  $t$ . By requiring the investor to act in a self-financing way (i.e., the investor's wealth only changes due to gains/losses from trading and due to consumption), the return of the wealth is given as

$$\frac{\mathrm{d}X^{\pi,c}(t)}{X^{\pi,c}(t)} = \left(1 - \sum_{i=1}^{n} \pi_i(t)\right) \frac{\mathrm{d}P_0(t)}{P_0(t)} + \sum_{i=1}^{n} \pi_i(t) \frac{\mathrm{d}P_i(t)}{P_i(t)} - \frac{c(t) \,\mathrm{d}t}{X^{\pi,c}(t)} \quad (5)$$

leading to the stochastic differential equation (the "wealth equation")

$$dX^{\pi,c}(t) = X^{\pi,c}(t) \left( \left( r(t) + \sum_{i=1}^{n} \pi_i(t)(b_i - r) \right) dt + \sum_{i=1}^{n} \pi_i(t) \sum_{j=1}^{m} \sigma_{ij} dW_j(t) \right) - c(t) dt \quad (6)$$

with initial condition

$$X^{\pi,c}(0) = x \tag{7}$$

We call a self-financing pair  $(\pi, c)$  admissible for an initial wealth of x (and write  $(\pi, c) \in A(x)$ ) if the wealth equation (6) has a unique positive solution with  $c > 0$ . By this, we implicitly assume that  $(\pi, c)$  satisfies integrability conditions ensuring that the stochastic integrals in equation  $(6)$  are well defined.

To judge the performance of such a pair, we introduce the notion of a utility function:

**Definition 1** A strictly concave function  $U: (0,$  $\infty$ )  $\rightarrow$  *IR* with  $U \in C^2$  satisfying

$$U'(0) := \lim_{x \downarrow 0} U'(x) = +\infty,$$
  
$$U'(+\infty) := \lim_{x \to +\infty} U'(x) = 0 \tag{8}$$

is called a utility function.

#### **Remarks and Examples**

1. Note that the definition implies that a utility function has to be increasing ("more is better than less"), but the advantage of one additional unit decreases with increasing amount  $x$  ("decreasing marginal utility"). Popular examples of utility

functions are *U (x)* = 1 *<sup>γ</sup> <sup>x</sup><sup>γ</sup>* for *<sup>γ</sup>* <sup>∈</sup> *(*0*,* <sup>1</sup>*)* or *U (x)* = ln*(x)*.

- 2. By slight misuse of the above definition, we will also call a family of functions *U (t, .), t* ∈ [0*, T* ] a utility function if for fixed *t* ∈ [0*, T* ] *U (t, .)* is a utility function as a function of the second variable. An obvious example would be the product of a utility function *F*(.) as in Definition 1 and a discount factor, for example, *U (t, x)* = exp*(*−*ρt)F (x)*.
- 3. A utility function is introduced to model the investors attitude toward risk. This can be seen by considering two investment alternatives. One results in the constant payment of *A*, the other one in a random payment *B* with *E(B)* = *A*, both at the same time *T* . Then by Jensen's inequality, we obtain *U (A)* = *U (E(B)) > E(U (B))*. Thus, an investor with such a utility function *U* would automatically go for the less risky alternative, the reason why his behavior (again characterized by the utility function) is called *risk-averse* (read more on this in Chapter 3 of [3]).

**Definition 2** *The continuous-time portfolio problem of an investor with an initial wealth of x consists of maximizing his expected utility from final wealth and consumption on [0, T] by choosing the best possible portfolio and consumption process, that is, by solving*

$$\max_{(\pi,c)\in A'(x)} E\left(\int_0^T U_1(t,c(t))\,\mathrm{d}t + U_2(X^{\pi,c}(T))\right) \tag{9}$$

Here, *U*<sup>1</sup> and *U*<sup>2</sup> are utility functions. The restricted set *A (x)* consists of all those elements of *A(x)* where the expectation over the negative part of the utility functions in equation (9) is finite (ensuring that the expected value in expression (9) is defined).

#### **Remarks**

- 1. Although *U* ≡ 0 is no utility function, we introduce the *pure consumption problem* by setting *U*<sup>2</sup> ≡ 0 and the *pure terminal wealth problem* by setting *U*<sup>1</sup> ≡ 0.
- 2. In the literature, there are mainly two different classes of methods to solve the continuoustime portfolio problem. The *stochastic control method* pioneered by Merton (see, e.g., [7, 8]) is based on the identification of the expected utility

maximization problem as a stochastic control problem. The optimal solution is then computed by solving the so-called Hamilton–Jacobi– Bellman equation of dynamic programming (*see* **Stochastic Control** for details on the stochastic control method). The second method, the *martingale method*, is tailored around the specific properties of the market model. We describe it in more details below.

## **The Martingale Method in the Complete Market Case**

The martingale method goes back to [1, 2] and [9]. It relies on decomposing the dynamic portfolio problem (9) into two simpler subproblems, a static optimization problem and a representation problem. We demonstrate the martingale method in a complete market setting (i.e., we assume *m* = *n*). Here, every contingent claim (i.e., the sum of a nonnegative terminal payment *B* and a payout process *g(t)*) can be replicated by following a suitable portfolio strategy. Let us introduce the state-dependent discount process

$$H(t) := \exp\left(-\int_0^t (r(s) - 1/2 \|\theta(s)\|^2) \,\mathrm{d}s - \int_0^t \theta(s)' \,\mathrm{d}W(s)\right) \tag{10}$$

with *θ (t )* := *σ (t)*<sup>−</sup><sup>1</sup>*(b(t)* − *r(t)*1*).*

The completeness of the market allows to treat the problems of finding the optimal final wealth and finding the corresponding optimal portfolio process separately. More precisely, if a final payment of *B* and a consumption process *c(t)* have an initial price satisfying

$$x = E\left(H(T)B + \int_0^T H(t)c(t) dt\right) \tag{11}$$

then a portfolio process *(π, c)* ∈ *A(x)* resulting in a final wealth of *B* always exists.

We demonstrate this in the case of a pure terminal wealth problem (i.e., *U*<sup>1</sup> = 0): we decompose the portfolio problem into a *static optimization problem*

$$\max_{\mathbf{B}\in\mathcal{B}(x)}E(U(\mathcal{B}))\tag{12}$$

with  $B(x) := \{B | B \ge 0, f_T\}$ - measurable,  $E(H(T))$  $B = x, E(U(B^{-})) < \infty$  being the set of all contingent claims  $B$  maturing at  $T$  and having an initial price of  $x$ , and the *representation problem* to find a portfolio process  $\pi^* \in A'(x)$  with

$$X^{x,\pi^*}(T) = B^* \quad a.s. \tag{13}$$

where  $B^*$  solves the static optimization problem (12).

Note that the optimization problem  $(12)$  is simpler than the original portfolio problem (9) as we only have to optimize over a set of distributions and not over a class of stochastic processes. It can be solved directly with the help of convex optimization and Lagrangian multiplier considerations, even in the general case including consumption. To state the explicit form of the optimal final wealth and consumption we need the following notation:

$$I_2(\lambda) := (U_2')^{-1}(\lambda),$$
  

$$I_1(t,\lambda) := \left(\frac{\partial}{\partial x} U_1\right)^{-1}(t,\lambda)$$
(14)

$$G(\lambda) := E\left(H(T)I_2(\lambda H(T)) + \int_0^T H(t)I_1(t, \lambda H(t)) dt\right)$$
(15)

**Theorem 1** Let  $x > 0$ . Under the assumption of

$$G(\lambda) < \infty \quad \forall \lambda > 0 \tag{16}$$

the inverse function  $\Lambda(x)$  to  $G(\lambda)$  exists and the optimal terminal wealth  $B^*$  and the optimal consumption *process*  $c^*(t)$ ,  $t \in [0, T]$ , are given by

$$B^* = I_2(\Lambda(x)H(T)), \quad c^*(t) = I_1(t, \Lambda(x)H(t))$$
(17)

Further, there exists a portfolio process  $\pi^*(t), t \in$  $[0, T]$  with  $(\pi^*, c^*) \in A'(x)$ ,

$$X^{\pi^*,c^*}(T) = B^*(T) \quad a.s. \tag{18}$$

and  $(\pi^*, c^*)$  is the optimal strategy for the portfolio/consumption problem. Moreover, the optimal wealth process is given by

$$X^{\pi^*,c^*}(t) = E\left(\frac{H(T)}{H(t)}B^* + \int_t^T \frac{H(s)}{H(t)}c^*(s) \,\mathrm{d}s \bigg| \ f_t\right) \tag{19}$$

#### **Remarks**

- 1. While the optimization problem (12) is now explicitly solved up to the (possibly numerical) determination of the number  $\Lambda(x)$ , we have only stated existence of an optimal portfolio process  $\pi^*$ . Its explicit determination can be quite complicated and has to rely on very sophisticated methods such as Malliavin derivatives if the market coefficients are not constant and if the utility function is different from the logarithmic one of the example below.
- 2. We obtain the solution to the pure terminal wealth problem from Theorem 1 by setting  $U_1$ and  $I_1$  equal to zero. Setting  $U_2$  and  $I_2$  equal to zero, we get the optimal solution of the consumption problem.

**Example 1** Log-Utility In the case of  $U_1(t,x) =$  $U_2(x) = \ln(x)$ , we can perform all the calculations explicitly to obtain the optimal final wealth  $B^*$  and the optimal consumption  $c^*$  as

$$B^* = \frac{x}{T+1} \frac{1}{H(T)}, \quad c^*(t) = \frac{x}{T+1} \frac{1}{H(t)} \quad (20)$$

From this, the optimal wealth process as given in equation  $(19)$  can be determined as

$$X^{\pi^*,c^*}(t) = E\left(\frac{H(T)}{H(t)}B^* + \int_t^T \frac{H(s)}{H(t)}c^*(s) \,ds \bigg| \ f_t\right)$$
$$= \frac{x(T-t+1)}{(T+t)} \frac{1}{H(t)} \tag{21}$$

By deriving the differential representation for it with the help of Itô's formula and comparing this representation with the general wealth equation (6), we can identify

$$c^*(t) = \frac{1}{T+1-t} X^{\pi^*, c^*}(t),$$
  
$$\pi^*(t) = (\sigma(t)\sigma(t)')^{-1}(b(t) - r(t)\underline{1}) \qquad (22)$$

Note that here the optimal consumption is proportional to the current wealth with an increasing proportionality factor ("Increase relative consumption with growing time.") The optimal fractions of wealth invested in the different securities only depend on the market coefficients and not on the wealth process itself. In particular, the fractions remain constant if the market coefficients are also constant.

## The Martingale Method and **Mean-Variance Optimization**

In this section, we mention some possible generalizations of the martingale method. They will, in particular, allow us to treat a continuous-time version of the classical mean-variance problem (see [6] for the one-period model). For simplicity, we concentrate on the pure terminal wealth problem. Let us also relax the requirements on a utility function:

**Definition 3** A strictly concave function  $U$ :  $(0,\infty) \to IR$  with  $U \in C^2$  satisfying

$$U'(0) := \lim_{x \to 0} U'(x) > 0,$$
  
$$U'(z) = 0 \text{ for } a \ z \in (0, +\infty]$$
(23)

is called a (weak) utility function.

#### Remarks

- 1. The most popular examples of utility functions in the sense of Definition 3, which do not satisfy the conditions of Definition 1, are  $U(x) = \alpha$  –  $\exp(-\lambda x)$  for  $\alpha$ ,  $\lambda > 0$ , the exponential utility function, and  $U(x) = -1/2(x - K)^2$  for  $K > 0$ . the quadratic utility function.
- 2. One can show (see [3], Chapter 3) that with the generalized inverse function

$$I(\lambda) := \begin{cases} (U')^{-1}(\lambda), & \lambda \in [0, U'(0)] \\ 0, & \lambda \ge U'(0) \end{cases} \tag{24}$$

the results of Theorem 1 remain true in the case that the investor cannot afford to reach the point of maximum utility for sure. This is always the case if we have

$$x < z \cdot E(H(T)) \tag{25}$$

Example 2 Quadratic Utility In the case of  $U(x) = -1/2(x - K)^2$  and  $x < z \cdot E(H(T))$  using Theorem 1 in the sense of the preceding remark leads to the optimal terminal wealth of

$$B^* = I(\Lambda(x)H(T)) = (K - \Lambda(x)H(T))^+ \quad (26)$$

where the number  $\Lambda(x)$  is the unique solution of the equation

$$G(\lambda) = E(H(T)(K - \lambda H(T))^{+}) = x \qquad (27)$$

In the particular case of constant market coefficients and only one stock, that is,  $n = m = 1$  we can calculate  $G(\lambda)$  explicitly as

$$G(\lambda) = K \ e^{-rT} \Phi\left(\frac{\ln(K/\lambda) + (r - 1/2\theta^2)T}{\theta\sqrt{T}}\right)$$
$$- \lambda e^{(-2r + \theta^2)T} \Phi\left(\frac{\ln(K/\lambda) + (r - 3/2\theta^2)T}{\theta\sqrt{T}}\right)$$
(28)

with  $\theta := (b_1 - r)/\sigma_{11}$ . We can then easily solve equation (27) by numerical methods. One can compute the corresponding portfolio process  $\pi^*$  as indicated in [4]. This, however, is quite technical and requires the solution of a partial differential equation.

For dealing with constrained terminal wealth problems of the form

$$\max_{\pi \in A'_T(x)} E(U(X^{\pi}(T)))$$
  
subject to  $E(G_i(X^{\pi}(T))) \le 0, i = 1, \dots, k$  (29)

with the functions  $G_i$  being real valued and convex, we introduce the Lagrangian function

$$L(\pi, d) := E((U - d'G)(X^{\pi}(T))),$$
  

$$\pi \in A'(x), \ d \in [0, \infty)^k$$
(30)

Here, the subscript  $T$  of the set of admissible portfolio processes indicates that they also have to be admissible for the constrained problem, that is, the expectations in the constraints have to be defined and have to be satisfied (in addition to the usual requirement of a nonnegative wealth process). Then, in [5] under assumption (25) it is proved that—given the existence of a solution to the constrained problem  $(29)$ —we obtain a solution to this problem by using the following algorithm:

**Step 1.** Solve the unconstrained portfolio problem

$$\max_{\pi \in A'(x)} L(\pi, d) \tag{31}$$

by the martingale method for fixed, but arbitrary  $d \in [0, \infty)^k$ 

Minimize the function  $L(\pi^*(d), d)$  with Step 2. respect to  $d \in [0, \infty)^k$  where  $\pi^*(d)$  is an optimal portfolio process for the maximization problem of Step 1.

Example 3 Continuous-Time Mean-Variance **Optimization** As an application, we solve a continuous-time version of the famous Markowitz meanvariance problem. The special feature of our solution is that we can guarantee nonnegativity of the final wealth process. This problem is intensively dealt with in the literature starting with [5] and generalized in a series of papers by Zhou *et al.* (see, e.g., [10]). Again, we assume that we are in the setting of constant market coefficients and  $n = m = 1$ . Then, one can show that under the assumption of

$$x < Ke^{-rT} \tag{32}$$

the continuous-time mean-variance problem

$$\min_{\substack{\pi \in A'_T(y), y \le x}} Var(X^{\pi}(T))$$
  
subject to  $E(X^{\pi}(T)) \ge K$  (33)

(with  $K > 0$  a given constant) is equivalent to solving

$$\max_{\pi \in A'_T(x)} E(-1/2(X^{\pi}(T) - K)^2)$$
  
subject to  $K - E(X^{\pi}(T)) < 0$  (34)

This, however, is a problem that can be solved by the above two-step algorithm. If in addition one realizes that we have

$$L(\pi, d) = 1/2d^2$$
  
+ 
$$\max_{\pi \in A'_T(x)} E(-1/2(X^{\pi}(T) - (K+d))^2)$$
  
(35)

we can use the calculations of the quadratic utility case to solve the unconstrained portfolio problems. A deterministic minimization in  $d > 0$  then yields the solution to the continuous-time mean-variance problem under nonnegativity constraints on the terminal wealth.

The martingale method can also be applied to portfolio problems in incomplete markets. Then, however, convex duality methods have to be used to deal with constraints on the portfolio process or with the fact that the underlying market model is not

complete (see Chapter 4 of [3] for a survey on such constrained problems)

#### References

- Cox, J. & Huang, C.F. (1989). Optimal consumption and [1] portfolio policies when asset prices follow a diffusion process, Journal of Economic Theory 49, 33-83.
- Karatzas, I., Lehoczky, J.P. & Shreve, S.E. (1987). [2] Optimal portfolio and consumption decisions for a "small investor" on a finite horizon, SIAM Journal on Control and Optimization 27, 1157-1186.
- Korn, R. (1997). Optimal Portfolios, World Scientific, [3] Singapore.
- Korn, R. (1997). Some applications of L<sup>2</sup>-hedging with [4] a non-negative wealth process, Applied Mathematical Finance 4, 65-79.
- [5] Korn, R. & Trautmann, S. (1995). Continuous-time portfolio optimization under terminal wealth constraints, Zeitschrift für Operations Research 42, 69-92.
- [6] Markowitz, H. (1952). Portfolio selection, Journal of Finance 7, 77-91.
- Merton, R.C. (1969). Lifetime portfolio selection under [7] uncertainty: the continuous case, Reviews of Economical Statistics 51, 247-257.
- [8] Merton, R.C. (1971). Optimum consumption and portfolio rules in a continuous time model, Journal of Economic Theory 3, 373-413.
- Pliska, S. (1986). A stochastic calculus model of contin-[9] uous trading: optimal portfolios, Mathematics of Operations Research 11, 371-382.
- Zhou, X. & Li, D. (2000). Continuous-time mean- $[10]$ variance portfolio selection: a stochastic LQ framework, Applied Mathematics and Optimization 42, 19-33.

### **Related Articles**

**Expected Utility Maximization: Duality Methods;** Mean-Variance Hedging; Merton Problem; Risk-Return Analysis; Stochastic Control; Utility Function.

RALF KORN