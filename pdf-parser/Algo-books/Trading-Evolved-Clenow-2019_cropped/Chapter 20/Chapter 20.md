# **You can't beat all of the Monkeys all of the Time**

You shouldn't worry if you are being outperformed by a primate. It happens to the best of us. But let's take this from the beginning.

Back in 1973 the iconic book *A Random Walk Down Wall Street* was published, written by Burton Malkiel. There is much in this book which has not stood the test of time very well but there are also some parts which have been quite prophetic. The irony of it is of course that while much of his analysis was spot on, the conclusions turned out a little different.

The book is the main proponent of the so called Efficient Market Hypothesis. The academic theory that states that asset prices fully reflect all known information and that it's impossible to beat the market over time. Movement in stock prices when no new information has been made available is purely random and thereby unpredictable.

This theory has of course as much value as an academic paper proving that bumble bees are unable to fly. Empirical observation has continued to barrage this academic model for decades, and only career academics take it seriously anymore.

But I'm not writing this to discredit professor Malkiel's theories. After all, Warren Buffett has already done a pretty good job on that front. No, I'm bringing this book up because of a famous quote. One which turned out to be truer than the author likely expected, or desired.

*"A blindfolded monkey throwing darts at a*

#### *newspaper's financial pages could select a portfolio that would do just as well as one carefully selected by experts."*

Now we are talking. This is absolutely true. The mistake is in marginalizing the monkeys and discrediting their abilities. And of course, I fail to see the benefits of blindfolding the poor monkey, other than making him look funny.

The ability of primates to outperform the stock market is undisputed. The question is what we do with this knowledge. Professor Malkiel's conclusion was that we should abandon all hope of competing with the furry little guys and simply buy mutual funds. That may have seemed like a good idea back in the 70s, but that was before we had conclusive evidence of the failure of the mutual fund industry. The chimps will stand a better chance at delivering performance than a mutual fund.

Pointing out that mutual funds are a bad idea is not exactly bringing anything new to the table. The quarterly S&P Indices versus Active (SPIVA, 2019) reports published by S&P Dow Jones Indices are devastating. Around 80% of all mutual funds fail to match their benchmark index in any given 3 or 5 year period. The ones that do beat their benchmark tend to be different each year, indicating the impact of pure chance.

Mutual funds are designed to generate maximum revenue for fund managers and banks while ensuring that they underperform by a small enough margin that most retail savers don't realize what is going on. It's a nice business model. You launch a fund that invests almost all the assets like a given index composition. Small deviations are allowed, but within very strict tracking error budgets. The design is to avoid any noticeable deviation from the index.

Mutual funds charge a fixed yearly management fee, as a percentage of the assets, but that's of course not the entire revenue base. Most banks that offer mutual funds also have brokerage

departments, and this is of course where the fund trades. The flow information is valuable, knowing when and how the funds will rebalance and what orders they place. There are plenty of ways to make good money from mutual funds and all you need to do is to ensure that they won't deviate much from the benchmark index.

Back in the 70s when the book in question was written, this pattern was probably not as visible. Mutual funds must have seemed like a really good idea back then. What we know now is different, and it's highly unlikely for a mutual fund to outperform the proverbial primate. The mutual funds are not even trying to do that. There is no profitability in such an endeavor, not compared to playing it safe, showing a small underperformance and cashing in on big fees.

But I digress. None of this is new information. After all, pointing out that mutual funds are not great investments is at this point far beyond beating a dead horse. It more resembles yelling at the can of dog food in the supermarket where the horse eventually ended up. Buying mutual funds is not the answer.

Perhaps we should just resign and hire an office chimp. Yes, I'm aware that Malkiel called for a monkey, but using an ape barely seems like cheating. There are after all clear advantages of chimps compared to recruiting from the hedge fund industry, such as lower salary, better behavior and calmer tempers. Not everyone is however lucky enough to be able to retain the services of a cooperative primate. The good news is that we have a way of simulating the skills of these remarkable creatures. Random number generators.

## **Mr. Bubbles goes to Wall Street**

Before you set out to design trading strategies for the stock markets, you need to be aware of what your average, reasonably well behaved chimp would be expected to achieve. The fact of the matter is that a random stock picking approach will make a nice profit over time. I'm of course not suggesting that you pick your stocks at

random, but this knowledge does have implications.

Perhaps you design a stock picking model that shows quite nice long term results. You have been working on it for a long time, constructing a complex method of combining technical indicators, fundamental ratios and designing exact rules. Now your simulations clearly show that you will make money with these rules.

The question is of course, whether or not you will make more or less money than a random approach, and at higher or lower risk. It's quite easy to construct a model which performs more or less the same as a random approach, and in that case you need to ask yourself if you really added any value.

To demonstrate the principle, I will let our imaginary office chimp, Mr. Bubbles show some of his best strategies.

We will start with a simple classic. The Equal Random 50. The rules are really simple. At the start of every month, Mr. Bubbles will throw imaginary darts at an equally imaginary list of stocks, picking 50 stocks from those that were part of the S&P 500 index on the day of selection. The entire portfolio will be liquidated and replaced with 50 new stocks at the first of every month.

Now don't misunderstand what we are doing here. Only a chimp would actually trade this way. We are doing this to learn about the behavior of stocks. Put that keyboard away. You will have plenty of time to send me angry mails later.

Having selected 50 random stocks, we simply buy an equal amount of each. Not number of shares of course, but in value. In this case, we start off with 100,000 dollars and we invest 2,000 into each stock. This is why we call the strategy Equal Random 50. Equal sizing, random selection, 50 positions.

When dividends come in, they will be left in cash on the account until the next monthly rebalancing, when it will be used to buy stocks again. This strategy is always fully invested, with the

exception of these cash dividends.

This monkey strategy does not care at all about what stocks it's buying or what the overall market is doing. How do you think such a strategy would perform?

The intuitive response, which would be as reasonable as it would be incorrect, is that the results would be centered around the index. Much like how throwing darts at a board. If you aim for the center and throw enough number of times, you should in theory get a fairly even distribution around the center. Unless you have some sort of weird arm that pulls to the left of course.

The logical error with that response is to assume that the index is some sort of average. It's not. The index is a completely different systematic trading strategy. And a poorly designed one at that.

Since the simulations here use random numbers, it would of course be pointless to do it only once. After all, if you spin the roulette table once or twice, anything can happen. You might even win money. But if you spin it enough times, the end result is highly predictable and there is virtually no chance of you walking away from the Bellagio with any cash.

For every random strategy in this chapter, I will show 50 iterations. A few readers who studied statistics are probably shouting at the pages at this point, but no need to worry. I have done the same simulations with 500 iterations each and the results won't differ enough to warrant the visual mess of showing you 500 runs.

Figure 21‑1 shows you the result of these 50 iterations. There is no need to squint to try to make out the differences between all the lines. The most important to read from this chart is where the index is compared to the others. The index, in this case the S&P 500 Total Return Index, is shown as a thick black line to distinguish it from the others.

![](_page_5_Figure_0.jpeg)

The first and most obvious thing you should notice in this picture is that almost all of the random stock selection simulations ended up with more money than the index.

The second thing you might notice is that the random stock picking approach started beating the index just by the turn of the century. Back in the 90's, the index was in the lead. We will return to the reason for this later on.

![](_page_6_Figure_0.jpeg)

*Figure 21*‑*2 Random 50 Returns vs Volatility*

The higher overall returns are not free of course. Returns rarely are. Figure 21‑2 shows a scatter plot of returns versus volatility. This paints a somewhat different picture. As you can see here, the volatility is higher for all of the random strategies. For some of the random runs, we have about equal returns in the long run at higher volatility, and that's clearly not very attractive, but for many of them the returns are high enough to make up for the added volatility.

You might notice that I haven't mentioned trading costs yet. What about slippage and commissions? So far, I haven't applied any. No, no, it's not for the reason that you think. It's not to make the monkey selection look better. At least that's not the main reason. The reason is actually that in this case, it wouldn't make a fair comparison if we included these costs.

We are not trying to devise a practical trading plan here, making realistic accounting for costs, slippage and such to get to an expected return number. We are letting a chimp throw darts at a board

and there is very little realism about that. No, here we are comparing the concept of the index to the concept of Mr. Bubble's dart throwing skills. If we put trading costs on his strategy, we need to put trading costs on the S&P index as well.

The index does not include any such fees. The index is not constructed as some sort of realistic trading strategy with slippage and commissions. They assume that you can instantly buy and sell at the market at any amount without any fees or slippage at all. So it's only fair that Mr. Bubbles gets to do the same.

Other models in this book use realistic trading costs, but in this more theoretical chapter we will trade for free. For now, I'm just trying to make a point about the stock markets.

Clearly this seemingly ludicrous strategy is outperforming the market in the long run. Well, at least it has a higher than average probability of ending up with higher returns, at slightly higher volatility. At the very least, we can conclude that in comparison to the index methodology, the results are not completely outrageous.

There is no trick at work here. A random stock picking model would have had a high probability of beating the index in terms of returns for the past few decades. There is a reason for this of course, but we are going to throw a few more darts before getting to the actual point of this chapter.

The model we just tried used equal sizing. Perhaps that is the trick here. Just in case, we will remove that factor from the equation. Enter the Random Random 50 Model.

The Random Random 50 is mostly the same as the Equal Random 50. It replaces the entire portfolio monthly based on random selections from the index members. The only difference is that it does not allocate equal weight to the positions. Instead, it allocates a random weight. We always use 100% of available cash, but how much we buy of each stock is completely random.

This does make sense. After all, why would a chimp buy an equal amount of each stock?

What you see here, in Figure 21‑3 is a very similar pattern. We again see underperformance in the late 1990's followed by a very strong outperformance during a decade and a half after that.

There is quite a wide span between the best and the worst random iteration here, but even with the drag in the 90's, almost every one beats the index. Keep in mind how this graph would look if you instead plot actual, real life mutual funds against the index in the same way. Out of 50 randomly selected mutual funds, one or two would statistically be above the index. Not more. The very opposite of what the chimp strategies show. Invest with a mutual fund and you have a 20% chance of beating the benchmark. Invest with a chimp and you have an 80% chance.

![](_page_8_Figure_3.jpeg)

*Figure 21*‑*3 Random Selection, Random Size*

As for the scatter plot, it again looks quite similar. We have a

wider span, both in terms of volatility and returns. That would be expected, given the random position sizes and the extreme allocation effects that might bring.

![](_page_9_Figure_1.jpeg)

*Figure 21*‑*4 Random Selection, Random Size, Returns versus Volatility*

Again we have some iterations which are clearly worse than the index. They show higher volatility for lower returns, or similar returns for higher volatility. But most iterations show stronger returns in the long run.

We could take this little game even further and add a randomizer for the number of stocks to pick as well. But it really wouldn't matter all that much. The end result would be predictable. We would see an even wider span in both returns and volatility, and we would still see a higher expected return for the random model.

No, I think we will just skip ahead to the point of this chapter.

### **The Problem is with the Index**

Ok, so now we know that random stock picking outperforms the index, at least in that it has a very high chance of showing superior long term returns. The effect is there with equal sizing, with random sizing and even with random number of stocks. As long as we have a reasonable amount of stocks and avoid going utterly crazy with the allocation, we seem to outperform. At least after the 1990's. So what is the deal here? Did I just waste your time reading about nonsense strategies, or is there a point to be made here?

The issue, which is very easy to overlook, is what we are comparing to. Is there really a good reason to use the index as a benchmark? To understand why random stock selection appears favorable, you need to understand what the index really is. Just another trading model.

A market index is not some objective measurement of the financial markets. I'm not sure if such a thing exists or even how to go about creating a fair market measurement. In fact, I have never seen an index methodology that's not flawed in one way or another. That's not the fault of the index provider though. No matter how you construct an index, it will by necessity be geared towards some factor or another.

Most modern market indexes are based two main market factors. Long term momentum and market capitalization. Let's first look at why I claim that these indexes are momentum based, and then we will get to the more obvious market cap issue.

What does it take for a stock to join the S&P 500 Index? The actual selection is done on a discretionary basis by a committee, but any stock to be considered needs to fulfill certain criteria. The most important of these are that the stock need to have a total market worth in excess of 5 billion dollars. There are also rules regarding the liquidity and free float, to ensure that the stock can actually be traded in large scale.

Companies with a value of 5 billion dollars don't just pop into existence. They started out small and grew larger. As the stock price

rose, they became more valuable. At some point, they became valuable enough to be included in some index. So in a very real sense, the stocks in the S&P 500 are included primarily because they had strong price performance in the past. This is what makes the index a sort of momentum strategy. Perhaps not a great momentum strategy, but it's nevertheless a major factor in stock selection.

The second factor is closely related. The current market capitalization. However in this case, the issue is in the weighting. Most major indexes are weighted based on market cap. The most obvious exception being the Dow Jones, which is weighted purely on price level.

The issue with market cap is significant. If you were looking for the trick that makes the chimp strategies above appear to work, this is it. The market cap weighting model of most major indexes has the unintended side effect of destroying diversification.

Most people would assume that a broad index like the S&P 500 is highly diversified. After all, it covers the 500 largest companies in the United States. The problem is that the index price development would look almost identical if you simply skip the bottom 300 stocks. This is not a diversified index. It's extremely concentrated in a few massive companies.

The top three largest companies in the index have a combined weight of about 10.5%. That's about the same weight as the bottom 230 stocks. The highest weight company has at this time a weight of almost 4%, while the lowest weight is less than 0.01%. That's not diversification.

What it means is that when you invest in a traditional index way, you are really buying a factor strategy based on market cap. You are putting all of your money in a small number of extremely large companies. The rest of the stocks in the index really don't matter.

This is why the chimps are outsmarting us. It's not that they are doing something particularly right. It's more like the index is doing

something wrong.

At times the large cap stocks outperform the small caps. That happened in the mid to late 1990's. Most of the time however, the large caps underperform the mid and small caps. This effect can be seen even within an index like the S&P 500, where all stocks are by definition large caps. There is quite a large difference between a stock worth a few billions and one large enough to make the GDP of Switzerland look like a rounding error.

The largest companies in the world became that big because they were well performing mid to large caps. But once you have a market cap equivalent to the GDP of South America, the question is how many times you can possibly double from there. By necessity, these giants become slow movers after a while. They will have much more downside potential than upside.

These highly concentrated indexes are very popular though. One reason is of course that many people don't fully understand how concentrated they are, but that's just a small part of the story. The larger factor at work is group think.

There is a very old industry axiom that's very fitting in this context. "Nobody ever got fired for buying IBM". This proverb comes from the days when IBM was one of the largest companies in the world. The equivalent of Apple or Microsoft now. If you buy the proverbial IBM, you are doing what everyone else is doing, and you can't possibly be blamed for that. Most investments are done on behalf of other people. Fund managers and asset managers of various kinds. From that perspective, not getting blamed is a priority. You get paid by fees. If you lose money when everyone else loses money, you will be fine. Nobody can blame you for that. But if you try to do your best and risk failing, you might get fired. So it's in your interest to buy IBM.

The reason for the seemingly superior performance of the random strategies is that they did not use market capitalization weighting. This is also the reason why they underperformed in the

1990's. During the IT crash of 2000 to 2002, the largest companies took the biggest beating. That's why most random strategies did not.

The point here, I suppose, is that you need to be aware of what the index is. You also need to decide if your goal is to beat the index, or if your goal is index independent.

In the financial industry we talk about relative strategies and absolute return strategies. All too often, these very different approaches get mixed up. A relative strategy must always be compared to its benchmark index, while an absolute return strategy should not.

This can often be a problem in the industry. The fact that most people are not aware of the distinction. If you have an absolute return strategy and end a year at 15 percent up, that would normally be considered a good year. If the equity markets were down 20 percent that year, your clients will trust you to watch their kids over the weekend. But if the stock markets were up 25 percent, you quickly get taken off the Christmas card list.

## **Finding Mr. Bubbles**

In case you would like to try this at home, I will provide you the source code used for this experiment. Much of the code here is the same as the momentum model, but without the fancy momentum and allocation logic. Before showing the entire code, let's look at the interesting parts.

Apart from the same import statements that we had last time, we also need to get a library that can generate random numbers for us.

```
# To generate random numbers
from random import random, seed, randrange
```

We're using this to select random stocks. The actual list of eligible stocks are fetched the same way as before.

```
# Check eligible stocks
todays_universe = [
  symbol(ticker) for ticker in
  context.index_members.loc[context.index_members.index < today].iloc[-1,0].split(',')
]
```

The actual selection is done by a loop that's run once a month. Here we loop once for each stock that we'd need to select, and use the **random** library to generate a number. We make sure that this number will be between zero and the length of the list of stocks, minus one. Remember that lists are zero based.

You also see the use of pop( ) here, which is a convenient way of both selecting an item from a list and removing it from the list at the same time. This ensure that we won't pick the same stock twice.

```
for i in np.arange(1, number_of_stocks +1):
  num = randrange(0, len(todays_universe) -1)
  buys.append(todays_universe.pop(num))
```

The only other part here that is really new, is how we make a backtest run multiple times with the results stored. In this case, all that I was interested in was the portfolio value over time, so that's all that I stored in this loop.

```
# Run the backtests
for i in np.arange(1, number_of_runs + 1):
  print('Processing run ' + str(i))
```

```
result = zipline.run_algorithm(
  start=start, end=end,
  initialize=initialize,
  capital_base=100000,
  data_frequency = 'daily',
  bundle='ac_equities_db' )
```

```
df[i] = result['portfolio_value']
```

In the end, we will have a **DataFrame** with the portfolio value development over time, one column for each backtest run. Now all you need to do is to make some nice graphs or calculate some useful analytics.

#### The full source for the random stock picking model follows here below.

#### %matplotlib inline

import zipline

from zipline.api import order\_target\_percent, symbol, set\_commission, \ set\_slippage, schedule\_function, date\_rules, time\_rules

from zipline.finance.commission import PerTrade, PerDollar from zipline.finance.slippage import VolumeShareSlippage, FixedSlippage

from datetime import datetime import pytz import pandas as pd import numpy as np

# To generate random numbers from random import random, seed, randrange

"""

Settings """

number\_of\_runs = 2 random\_portfolio\_size = False number\_of\_stocks = 50 # portfolio size, if not random sizing\_method = 'equal' # equal or random

```
enable_commission = False
commission_pct = 0.001
enable_slippage = False
slippage_volume_limit = 0.025
slippage_impact = 0.05
```

```
def initialize(context):
```

```
# Fetch and store index membership
  context.index_members = pd.read_csv('../data/index_members/sp500.csv', index_col=0,
parse_dates=[0])
```

```
# Set commission and slippage.
if enable_commission:
  comm_model = PerDollar(cost=commission_pct)
else:
  comm_model = PerDollar(cost=0.0)
set_commission(comm_model)
```

if enable\_slippage: slippage\_model=VolumeShareSlippage(volume\_limit=slippage\_volume\_limit, price\_impact=slippage\_impact)

else: slippage\_model=FixedSlippage(spread=0.0) set\_slippage(slippage\_model)

```
schedule_function(
  func=rebalance,
  date_rule=date_rules.month_start(),
  time_rule=time_rules.market_open()
)
```

```
def rebalance(context, data):
  today = zipline.api.get_datetime()
```

# Check eligible stocks todays\_universe = [ symbol(ticker) for ticker in context.index\_members.loc[context.index\_members.index < today].iloc[-1,0].split(',') ]

```
# Make a list of stocks to buy
buys = []
```

# To modify global variable, and not make new one global number\_of\_stocks

```
# If random stockss selected
if random_portfolio_size:
  # Buy between 5 and 200 stocks.
  number_of_stocks = randrange(5, 200)
```

```
# Select stocks
for i in np.arange(1, number_of_stocks +1):
  num = randrange(0, len(todays_universe) -1)
  buys.append(todays_universe.pop(num))
```

# Sell positions no longer wanted. for security in context.portfolio.positions: if (security not in buys): order\_target\_percent(security, 0.0)

#Make an empty DataFrame to hold target position sizes buy\_size = pd.DataFrame(index=buys)

```
# Get random sizes, if enabled.
if sizing_method == 'random':
  buy_size['rand'] = [randrange(1,100) for x in buy_size.iterrows()]
  buy_size['target_weight'] = buy_size['rand'] / buy_size['rand'].sum()
elif sizing_method == 'equal':
  buy_size['target_weight'] = 1.0 / number_of_stocks
```

# Send buy orders for security in buys: order\_target\_percent(security, buy\_size.loc[security, 'target\_weight'])

```
start = datetime(1996, 1, 1, tzinfo=pytz.UTC)
end = datetime(2018, 12, 31, tzinfo=pytz.UTC)
```

# Empty DataFrame to hold the results df = pd.DataFrame()

# Run the backtests for i in np.arange(1, number\_of\_runs + 1): print('Processing run ' + str(i))

result = zipline.run\_algorithm( start=start, end=end, initialize=initialize, capital\_base=100000, data\_frequency = 'daily', bundle='ac\_equities\_db' )

```
df[i] = result['portfolio_value']
```

```
print('All Done. Ready to analyze.')
```

After this code is all done, the resulting data is in the d f object, and you can save it to disk or use techniques described in previous chapter to chart or analyze it.